<!doctype html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHARUSAT â€” Student Feedback & Department Review</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Grand+Hotel&display=swap" rel="stylesheet">
  <style>
    body {
      background: #18191a;
      color: #f5f6fa;
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .card {
      background: #23272b;
      border: 1px solid #262626;
      border-radius: 18px;
      padding: 40px 36px 32px 36px;
      max-width: 480px;
      margin: 48px auto;
      box-sizing: border-box;
      box-shadow: 0 8px 32px rgba(0,0,0,0.22);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .charusat-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 18px;
    }
    .charusat-header img {
      display: block;
      margin: 0 auto 14px auto;
      max-width: 90px;
      border-radius: 18px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.16);
    }
    .charusat-header h1 {
      font-family: 'Grand Hotel', cursive;
      font-size: 2.2rem;
      font-weight: 400;
      color: #fff;
      text-align: center;
      margin-bottom: 6px;
      letter-spacing: 0.02em;
    }
    .charusat-desc {
      color: #b3b3b3;
      font-size: 1.08rem;
      margin-bottom: 22px;
      text-align: center;
    }
    .charusat-form {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 7px;
      margin-bottom: 2px;
    }
    .form-group label {
      font-size: 1.08rem;
      color: #f5f6fa;
      margin-bottom: 2px;
      font-weight: 500;
      letter-spacing: 0.01em;
    }
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group select,
    .form-group textarea {
      background: #23272b;
      border: 1.5px solid #363636;
      border-radius: 10px;
      color: #f5f6fa;
      padding: 14px 12px;
      font-size: 1.08rem;
      outline: none;
      font-family: 'Roboto', Arial, sans-serif;
      margin-bottom: 2px;
      box-sizing: border-box;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .form-group input[type="text"]:focus,
    .form-group input[type="email"]:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: #0095f6;
      box-shadow: 0 0 0 2px rgba(0,149,246,0.15);
    }
    .form-group select {
      appearance: none;
      background: #23272b url('data:image/svg+xml;utf8,<svg fill="%23b3b3b3" height="16" viewBox="0 0 20 20" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M7.293 7.293a1 1 0 011.414 0L10 8.586l1.293-1.293a1 1 0 111.414 1.414l-2 2a1 1 0 01-1.414 0l-2-2a1 1 0 010-1.414z"/></svg>') no-repeat right 12px center/16px 16px;
      padding-right: 36px;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 90px;
      max-height: 220px;
      font-size: 1.08rem;
      line-height: 1.5;
      border-radius: 10px;
    }
    .form-group input[type="checkbox"] {
      accent-color: #0095f6;
      margin-right: 8px;
      vertical-align: middle;
      width: 18px;
      height: 18px;
    }
    .checkbox-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 2px;
    }
    .checkbox-tags label {
      display: flex;
      align-items: center;
      background: #23272b;
      color: #b3b3b3;
      border-radius: 18px;
      padding: 8px 18px;
      font-size: 1.01rem;
      cursor: pointer;
      border: 1px solid #262626;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
      font-weight: 400;
    }
    .checkbox-tags input[type="checkbox"]:checked + label {
      background: #0095f6;
      color: #fff;
      border-color: #0095f6;
    }
    .star-widget {
      display: inline-flex;
      font-size: 1.7rem;
      color: #ffd700;
      margin-bottom: 4px;
      letter-spacing: 2px;
      user-select: none;
      gap: 2px;
    }
    .star-widget .star {
      cursor: pointer;
      margin-right: 2px;
      transition: color 0.2s, transform 0.1s;
      font-size: 1.7rem;
      border-radius: 50%;
      padding: 2px;
    }
    .star-widget .star.selected {
      color: #ffb400;
      transform: scale(1.18);
      background: #23272b;
      box-shadow: 0 2px 8px rgba(255,180,0,0.08);
    }
    .star-widget .star:hover {
      color: #ffb400;
      transform: scale(1.22);
      background: #23272b;
      box-shadow: 0 2px 12px rgba(255,180,0,0.12);
    }
    .rating-comment {
      background: #23272b;
      color: #f5f6fa;
      border: 1.5px solid #363636;
      border-radius: 10px;
      padding: 11px;
      font-size: 1.01rem;
      margin-top: 2px;
      margin-bottom: 2px;
      width: 100%;
      box-sizing: border-box;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .rating-comment:focus {
      border-color: #0095f6;
      box-shadow: 0 0 0 2px rgba(0,149,246,0.15);
    }
    .charusat-submit {
      background: linear-gradient(90deg, #0095f6 0%, #005fa3 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 16px 0;
      font-size: 1.18rem;
      font-weight: 700;
      margin-top: 16px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
      font-family: 'Roboto', Arial, sans-serif;
      box-shadow: 0 2px 8px rgba(0,149,246,0.08);
      letter-spacing: 0.01em;
    }
    .charusat-submit:hover {
      background: linear-gradient(90deg, #0077c2 0%, #005fa3 100%);
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 4px 16px rgba(0,149,246,0.12);
    }
    .charusat-submit:active {
      background: linear-gradient(90deg, #005fa3 0%, #0077c2 100%);
      transform: translateY(2px) scale(0.96);
    }
    .form-errors {
      color: #ed4956;
      font-size: 1.09rem;
      font-weight: 600;
      margin-bottom: 12px;
      text-align: center;
      background: #2a1a1a;
      border-radius: 8px;
      padding: 10px 0;
      box-shadow: 0 1px 4px rgba(237,73,86,0.08);
    }
    .char-count {
      color: #8e8e8e;
      font-size: 0.99rem;
      text-align: right;
      margin-top: -8px;
      margin-bottom: 8px;
    }
    .gf-success-card {
      max-width: 480px;
      margin: 40px auto 0 auto;
      background: #23272b;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.22);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      overflow: hidden;
      min-height: 340px;
      border: 1px solid #262626;
    }
    .gf-topbar {
      height: 8px;
      background: linear-gradient(90deg, #0095f6 0%, #005fa3 100%);
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      width: 100%;
    }
    .gf-content {
      padding: 48px 40px 32px 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1 1 auto;
    }
    .gf-heading {
      font-family: 'Grand Hotel', cursive;
      font-size: 2rem;
      font-weight: 400;
      color: #fff;
      margin-bottom: 0.5em;
      margin-top: 0;
      text-align: center;
      letter-spacing: 0.02em;
    }
    .gf-subtext {
      font-family: 'Roboto', Arial, sans-serif;
      font-size: 1.08rem;
      color: #b3b3b3;
      margin-bottom: 1.2em;
      text-align: center;
    }
    .gf-help {
      font-family: 'Roboto', Arial, sans-serif;
      font-size: 1.01rem;
      color: #b3b3b3;
      text-align: center;
    }
    .gf-link {
      color: #0095f6;
      text-decoration: none;
      transition: text-decoration 0.2s, color 0.2s;
    }
    .gf-link:hover, .gf-link:focus {
      text-decoration: underline;
      color: #0077c2;
    }
    .gf-footer {
      font-family: 'Roboto', Arial, sans-serif;
      font-size: 0.99rem;
      color: #8e8e8e;
      text-align: center;
      padding: 18px 0 14px 0;
      background: none;
      border-bottom-left-radius: 18px;
      border-bottom-right-radius: 18px;
    }
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .modal-content {
      background: #23272b;
      color: #f5f6fa;
      border-radius: 18px;
      padding: 32px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.18);
      text-align: center;
      max-width: 340px;
    }
    .charusat-footer {
      color: #8e8e8e;
      font-size: 1.01rem;
      text-align: center;
      padding: 24px 0 8px 0;
      font-family: 'Roboto', Arial, sans-serif;
    }
    @media (max-width: 600px) {
      body {
        min-height: 100vh;
        font-size: 1.08rem;
      }
      .card, .gf-success-card {
        max-width: 100vw;
        margin: 0;
        border-radius: 0;
        box-shadow: none;
        padding: 10px 0 8px 0;
      }
      .charusat-header {
        margin-bottom: 10px;
      }
      .charusat-header img {
        max-width: 48px;
        margin-bottom: 8px;
      }
      .charusat-header h1 {
        font-size: 1.25rem;
        margin-bottom: 2px;
      }
      .charusat-desc {
        font-size: 1.01rem;
        margin-bottom: 12px;
        color: #e0e0e0;
      }
      .charusat-form {
        gap: 14px;
      }
      .form-group {
  gap: 8px;
  margin-bottom: 10px;
      }
      .form-group label {
        font-size: 1.09rem;
        margin-bottom: 1px;
      }
      .form-group input[type="text"],
      .form-group input[type="email"],
      .form-group select,
      .form-group textarea {
        font-size: 1.09rem;
        padding: 13px 10px;
        border-radius: 12px;
        min-height: 44px;
      }
      .form-group textarea {
  min-height: 110px;
  max-height: 220px;
  font-size: 1.12rem;
  padding: 16px 12px;
      }
      .form-group select {
        padding-right: 32px;
      }
      .checkbox-tags {
  flex-direction: column !important;
  gap: 8px;
  width: 100%;
  align-items: stretch;
      }
      .checkbox-tags label {
  width: 100%;
  min-width: 0;
  box-sizing: border-box;
  padding: 13px 16px;
  font-size: 1.09rem;
  border-radius: 18px;
  margin-bottom: 0;
  margin-top: 0;
  justify-content: flex-start;
  align-items: center;
  display: flex;
  transition: background 0.2s, color 0.2s, border-color 0.2s;
      }
      .star-widget {
        font-size: 2.1rem;
        gap: 6px;
      }
      .star-widget .star {
        padding: 6px;
        margin-right: 0;
        min-width: 38px;
        min-height: 38px;
      }
      .charusat-submit {
        font-size: 1.22rem;
        padding: 18px 0;
        border-radius: 14px;
        margin-top: 10px;
        width: 100%;
      }
      .form-errors {
        font-size: 1.12rem;
        padding: 12px 0;
      }
      .char-count {
        font-size: 1.01rem;
        margin-bottom: 4px;
        color: #b3b3b3;
      }
      .modal {
        align-items: flex-end;
        padding: 0;
      }
      .modal-content {
        border-radius: 0;
        padding: 24px 10vw;
        max-width: 100vw;
        min-width: 100vw;
        min-height: 40vh;
      }
      .gf-success-card {
        min-height: 100vh;
        padding: 0;
      }
      .gf-heading {
        font-size: 1.18rem;
      }
      .gf-content {
        padding: 24px 6vw 18px 6vw;
      }
      .gf-footer {
        font-size: 0.97rem;
        padding: 12px 0 8px 0;
      }
      .charusat-footer {
        font-size: 0.97rem;
        padding: 12px 0 8px 0;
      }
    }
  </style>
</head>
<body>
  <main class="center">
    <div class="card">
      <div class="charusat-header">
        <img src="./images/image.png" alt="CHARUSAT Logo" class="charusat-logo" />
        <h1>Share Your Experience about CHARUSAT</h1>
      </div>
      <div class="charusat-desc">We welcome feedback from students, parents, alumni, and visitors. Your input helps us understand how CHARUSAT is perceived and how we can improve. Thank you for sharing your honest experience.</div>
      <form action="/feedbackform" method="post" id="reviewForm" class="charusat-form" autocomplete="off" novalidate aria-label="CHARUSAT Public Review Form">
        ...existing code...
      </form>
      <div id="successCard" class="gf-success-card" style="display:none;">
        ...existing code...
      </div>
      <div id="clearModal" class="modal" style="display:none;">
        ...existing code...
      </div>
      <footer class="charusat-footer">For privacy concerns contact: feedback@charusat.edu.in (placeholder)</footer>
    </div>
  </main>
  <script src="app.js"></script>
</body>
</html>
          <select id="department" name="department" required>
            <option value="">Select Department/School</option>
            <option>DEPSTAR (Engineering)</option>
            <option>Pharmacy</option>
            <option>Management</option>
            <option>Applied Sciences</option>
            <option>Nursing</option>
            <option>Physiotherapy</option>
            <option>Others</option>
          </select>
        </div>
        <div class="form-group">
          <label>Visit/Interaction Type <span aria-hidden="true" style="color:#c00">*</span></label>
          <div class="checkbox-tags" id="visitTypes">
            <label><input type="checkbox" value="Campus Visit" /> Campus Visit</label>
            <label><input type="checkbox" value="Admissions" /> Admissions</label>
            <label><input type="checkbox" value="Seminar/Workshop" /> Seminar/Workshop</label>
            <label><input type="checkbox" value="Online Event" /> Online Event</label>
            <label><input type="checkbox" value="Friend/Relative studies here" /> Friend/Relative studies here</label>
            <label><input type="checkbox" value="Other" /> Other</label>
          </div>
        </div>
        <div class="form-group rating-group">
          <label>Teaching Quality <span aria-hidden="true" style="color:#c00">*</span></label>
          <div class="star-widget" data-category="teaching" aria-label="Teaching Quality rating" tabindex="0"></div>
          <input type="text" class="rating-comment" id="teachingComment" maxlength="100" placeholder="Comment (optional)" aria-label="Teaching Quality comment" />
        </div>
        <div class="form-group rating-group">
          <label>Lab & Practical Facilities <span aria-hidden="true" style="color:#c00">*</span></label>
          <div class="star-widget" data-category="lab" aria-label="Lab & Practical Facilities rating" tabindex="0"></div>
          <input type="text" class="rating-comment" id="labComment" maxlength="100" placeholder="Comment (optional)" aria-label="Lab & Practical Facilities comment" />
        </div>
        <div class="form-group rating-group">
          <label>Course Content & Relevance <span aria-hidden="true" style="color:#c00">*</span></label>
          <div class="star-widget" data-category="content" aria-label="Course Content & Relevance rating" tabindex="0"></div>
          <input type="text" class="rating-comment" id="contentComment" maxlength="100" placeholder="Comment (optional)" aria-label="Course Content & Relevance comment" />
        </div>
        <div class="form-group rating-group">
          <label>Assessment & Feedback <span aria-hidden="true" style="color:#c00">*</span></label>
          <div class="star-widget" data-category="assessment" aria-label="Assessment & Feedback rating" tabindex="0"></div>
          <input type="text" class="rating-comment" id="assessmentComment" maxlength="100" placeholder="Comment (optional)" aria-label="Assessment & Feedback comment" />
        </div>
        <div class="form-group rating-group">
          <label>Administrative Support <span aria-hidden="true" style="color:#c00">*</span></label>
          <div class="star-widget" data-category="admin" aria-label="Administrative Support rating" tabindex="0"></div>
          <input type="text" class="rating-comment" id="adminComment" maxlength="100" placeholder="Comment (optional)" aria-label="Administrative Support comment" />
        </div>
        <div class="form-group rating-group">
          <label>Overall Satisfaction <span aria-hidden="true" style="color:#c00">*</span></label>
          <div class="star-widget" data-category="overall" aria-label="Overall Satisfaction rating" tabindex="0"></div>
          <input type="text" class="rating-comment" id="overallComment" maxlength="100" placeholder="Comment (optional)" aria-label="Overall Satisfaction comment" />
        </div>
        <div class="form-group">
          <label for="detailedFeedback">Detailed feedback (optional)</label>
          <textarea id="detailedFeedback" name="detailedFeedback" maxlength="3000" rows="4" aria-describedby="charCount"></textarea>
          <div class="char-count" id="charCount">0 / 3000</div>
        </div>
        <div class="form-group">
          <label>Common praise/issues (select all that apply):</label>
          <div class="checkbox-tags">
            <label><input type="checkbox" value="Good teaching" /> Good teaching</label>
            <label><input type="checkbox" value="Needs more labs" /> Needs more labs</label>
            <label><input type="checkbox" value="Exam scheduling issues" /> Exam scheduling issues</label>
            <label><input type="checkbox" value="Friendly staff" /> Friendly staff</label>
            <label><input type="checkbox" value="Infrastructure problems" /> Infrastructure problems</label>
            <label><input type="checkbox" value="Helpful faculty" /> Helpful faculty</label>
            <label><input type="checkbox" value="Clean campus" /> Clean campus</label>
            <label><input type="checkbox" value="Other" /> Other</label>
          </div>
        </div>
        <div class="form-group switch-group">
          <label for="anonToggle">Submit anonymously</label>
          <input type="checkbox" id="anonToggle" />
        </div>
        <div class="form-group consent-group">
          <input type="checkbox" id="consentCheck" required />
          <label for="consentCheck">I confirm this feedback is honest and I have read the privacy note. <span aria-hidden="true" style="color:#c00">*</span></label>
        </div>
        <div class="form-errors" id="formErrors" aria-live="polite"></div>
        <button type="submit" class="charusat-submit" id="submitBtn">Submit Feedback</button>
      </form>
      <div id="successCard" class="gf-success-card" style="display:none;">
        <div class="gf-topbar"></div>
        <div class="gf-content">
          <h1 class="gf-heading">You've already responded</h1>
          <div class="gf-subtext">You can fill out this form only once.</div>
          <div class="gf-help">Try contacting the <a href="mailto:feedback@charusat.edu.in" class="gf-link">owner of the form</a> if you think this is a mistake.</div>
        </div>
        <div class="gf-footer">This form was created inside of Charotar University of Science &amp; Technology.</div>
      </div>
      <div id="clearModal" class="modal" style="display:none;">
        <div class="modal-content">
          <p>Are you sure you want to clear all locally stored feedback responses? This cannot be undone.</p>
          <button id="modalYes">Yes, clear all</button>
          <button id="modalNo">Cancel</button>
        </div>
      </div>
      <footer class="charusat-footer">For privacy concerns contact: feedback@charusat.edu.in (placeholder)</footer>
    </div>
  </main>

  <style>
    body.gf-bg { background: #f6f3fc !important; }
    .gf-success-card {
      max-width: 700px;
      margin: 48px auto 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 16px 0 rgba(60,40,120,0.08), 0 1.5px 6px 0 rgba(60,40,120,0.04);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      overflow: hidden;
      min-height: 340px;
    }
    .gf-topbar {
      height: 8px;
      background: #673ab7;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
      width: 100%;
    }
    .gf-content {
      padding: 48px 40px 32px 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1 1 auto;
    }
    .gf-heading {
      font-family: 'Roboto', 'Inter', system-ui, sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #111;
      margin-bottom: 0.5em;
      margin-top: 0;
      text-align: center;
    }
    .gf-subtext {
      font-family: 'Roboto', 'Inter', system-ui, sans-serif;
      font-size: 16px;
      color: #333;
      margin-bottom: 1.2em;
      text-align: center;
    }
    .gf-help {
      font-family: 'Roboto', 'Inter', system-ui, sans-serif;
      font-size: 14px;
      color: #666;
      text-align: center;
    }
    .gf-link {
      color: #673ab7;
      text-decoration: none;
      transition: text-decoration 0.2s, color 0.2s;
    }
    .gf-link:hover, .gf-link:focus {
      text-decoration: underline;
      color: #4b2991;
    }
    .gf-footer {
      font-family: 'Roboto', 'Inter', system-ui, sans-serif;
      font-size: 13px;
      color: #777;
      text-align: center;
      padding: 18px 0 14px 0;
      background: none;
      border-bottom-left-radius: 12px;
      border-bottom-right-radius: 12px;
    }
    @media (max-width: 600px) {
      .gf-success-card {
        max-width: 100vw;
        margin: 0;
        border-radius: 0;
        min-height: 100vh;
        box-shadow: none;
      }
      .gf-content {
        padding: 32px 10vw 24px 10vw;
      }
    }
  </style>
  <script src="app.js"></script>
</body>
<script>
// Switch to Google Forms style background after submit
function setGFBackground() {
  document.body.classList.add('gf-bg');
}
// --- Inline JS for feedback form ---
document.addEventListener('DOMContentLoaded', function() {
  // --- Star rating widgets ---
  function createStarWidget(container) {
    let selected = 0;
    container.innerHTML = '';
    for (let i = 1; i <= 5; ++i) {
      const star = document.createElement('span');
      star.className = 'star';
      star.innerHTML = '&#9733;';
      star.tabIndex = 0;
      star.setAttribute('role', 'radio');
      star.setAttribute('aria-checked', 'false');
      star.setAttribute('aria-label', i + ' star');
      star.addEventListener('click', () => set(i));
      star.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') { set(i); e.preventDefault(); }
      });
      container.appendChild(star);
    }
    function highlight(val) {
      Array.from(container.children).forEach((star, idx) => {
        star.classList.toggle('selected', idx < val);
        star.setAttribute('aria-checked', idx + 1 === val ? 'true' : 'false');
      });
    }
    function set(val) {
      selected = val;
      highlight(val);
      container.dataset.selected = val;
      validateForm();
    }
    container.addEventListener('mouseleave', () => highlight(selected));
    container.dataset.selected = 0;
    return { get: () => selected, set };
  }
  const starCategories = ['teaching','lab','content','assessment','admin','overall'];
  const starWidgets = {};
  starCategories.forEach(cat => {
    const container = document.querySelector(`.star-widget[data-category="${cat}"]`);
    if (container) starWidgets[cat] = createStarWidget(container);
  });

  // --- Role: show/hide other role field ---
  const roleSelect = document.getElementById('role');
  const otherRoleGroup = document.getElementById('otherRoleGroup');
  roleSelect.addEventListener('change', function() {
    otherRoleGroup.style.display = (roleSelect.value === 'Other') ? '' : 'none';
    validateForm();
  });

  // --- Anonymity toggle ---
  const anonToggle = document.getElementById('anonToggle');
  const fullNameField = document.getElementById('fullName');
  anonToggle.addEventListener('change', function() {
    fullNameField.parentElement.style.display = anonToggle.checked ? 'none' : '';
    validateForm();
  });

  // --- Character count for detailed feedback ---
  const detailedFeedback = document.getElementById('detailedFeedback');
  const charCount = document.getElementById('charCount');
  detailedFeedback.addEventListener('input', function() {
    charCount.textContent = detailedFeedback.value.length + ' / 3000';
    validateForm();
  });
  charCount.textContent = detailedFeedback.value.length + ' / 3000';

  // --- Form validation ---
  const department = document.getElementById('department');
  const consentCheck = document.getElementById('consentCheck');
  const submitBtn = document.getElementById('submitBtn');
  const formErrors = document.getElementById('formErrors');
  function getCheckedTags() {
    return Array.from(document.querySelectorAll('.checkbox-tags input[type="checkbox"]:checked')).map(cb => cb.value);
  }
  function validateForm() {
    let errors = [];
    if (!roleSelect.value) errors.push('Select your role.');
    if (roleSelect.value === 'Other' && !document.getElementById('otherRole').value.trim()) errors.push('Specify your role.');
    if (!department.value) errors.push('Select a department/school.');
    if (!getCheckedTags().length) errors.push('Select at least one visit/interaction type.');
    let anyRating = false;
    for (const cat of starCategories) {
      if (starWidgets[cat] && starWidgets[cat].get() > 0) anyRating = true;
    }
    if (!anyRating) errors.push('Please provide at least one rating.');
    if (detailedFeedback.value.length > 3000) errors.push('Detailed feedback too long.');
    if (!consentCheck.checked) errors.push('You must confirm the consent checkbox.');
    formErrors.innerHTML = errors.length ? errors.map(e => `<div>${e}</div>`).join('') : '';
    submitBtn.disabled = errors.length > 0;
    return errors.length === 0;
  }
  [roleSelect, department, consentCheck].forEach(el => el.addEventListener('change', validateForm));
  document.querySelectorAll('.checkbox-tags input[type="checkbox"]').forEach(cb => cb.addEventListener('change', validateForm));
  document.querySelectorAll('.rating-comment').forEach(el => el.addEventListener('input', validateForm));
  validateForm();

  // --- Submission ---
  const reviewForm = document.getElementById('reviewForm');
  const successCard = document.getElementById('successCard');
  const summaryFields = document.getElementById('summaryFields');
    // Save to localStorage
    let arr = [];
    try { arr = JSON.parse(localStorage.getItem('charusat_reviews')||'[]'); } catch {}
    arr.push(data);
    localStorage.setItem('charusat_reviews', JSON.stringify(arr));
    // Show summary
    reviewForm.style.display = 'none';
    successCard.style.display = '';
    let html = `<div><strong>Department:</strong> ${data.department}</div>`;
    html += `<div><strong>Role:</strong> ${data.role}</div>`;
    if (!data.anonymous) {
      html += `<div><strong>Name:</strong> ${data.name || '(not provided)'}</div>`;
    } else {
      html += `<div><strong>Submitted anonymously</strong></div>`;
    }
    html += `<div><strong>Visit/Interaction:</strong> ${data.visitTypes.join(', ')}</div>`;
    html += `<div><strong>Ratings:</strong><ul style="margin:0 0 0 18px;">`;
    starCategories.forEach(cat => {
      if (data.ratings[cat]) html += `<li>${cat.charAt(0).toUpperCase()+cat.slice(1)}: ${data.ratings[cat]} star(s)${data.comments[cat] ? ' â€” '+data.comments[cat] : ''}</li>`;
    });
    html += `</ul></div>`;
    if (data.detailed) html += `<div><strong>Detailed feedback:</strong> ${data.detailed}</div>`;
    summaryFields.innerHTML = html;
  });

  // --- Success card actions ---
  const returnBtn = document.getElementById('returnBtn');
  if (returnBtn) {
    returnBtn.addEventListener('click', () => {
      reviewForm.reset();
      successCard.style.display = 'none';
      reviewForm.style.display = '';
      // Reset stars
      starCategories.forEach(cat => starWidgets[cat]?.set(0));
      charCount.textContent = '0 / 3000';
      validateForm();
    });
  }
</script>
</html>
